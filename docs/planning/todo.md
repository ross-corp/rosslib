# Features

Backlog of small tasks for nephewbot to pick off. Each item should be self-contained and implementable without external coordination.

## stats & data

- [ ] Add a reading log / timeline view. Create `GET /users/:username/timeline?year=2026` (public, respects privacy) that returns books read in a given year grouped by month. Query: join `user_books` with `books` where the user has a "finished" tag value AND `date_read` falls in the requested year. Return `{year, months: [{month: 1, books: [{book_id, open_library_id, title, cover_url, rating, date_read}]}]}`. Sort books within each month by `date_read`. Frontend: `/[username]/timeline` page with a year selector dropdown and month-by-month sections, each showing a horizontal row of book covers (reuse `BookCoverRow`). Default to the current year. Empty months are omitted.

## moderation & safety

- [ ] Add content reporting. Create a `reports` PocketBase collection (fields: `reporter` relation to users, `content_type` select `review`/`thread`/`comment`/`link`, `content_id` text required, `reason` select `spam`/`harassment`/`inappropriate`/`other`, `details` text optional, `status` select `pending`/`reviewed`/`dismissed`, `reviewer` relation to users optional, `created` auto). API endpoints: `POST /reports` (auth required; body: `{content_type, content_id, reason, details?}`; prevents duplicate reports from same user on same content), `GET /admin/reports?status=pending` (moderator only; returns reports with reporter username and content preview), `PATCH /admin/reports/:id` (moderator only; update status to `reviewed` or `dismissed`, sets `reviewer`). Frontend: small flag icon on reviews, thread comments, and community links. Clicking opens a modal with reason dropdown and optional details textarea. Admin page gets a new "Reports" section (similar to Feedback section) showing pending reports with content preview, reporter info, and review/dismiss buttons.

- [ ] Add notification preferences. Create a `notification_preferences` PocketBase collection (fields: `user` relation to users unique, `new_publication` bool default true, `book_new_thread` bool default true, `book_new_link` bool default true, `book_new_review` bool default true, `review_liked` bool default true, `thread_mention` bool default true, `book_recommendation` bool default true). API endpoints: `GET /me/notification-preferences` (returns current prefs or defaults if no row exists), `PUT /me/notification-preferences` (upsert — only update provided fields). Before creating any notification, check the recipient's preferences and skip if that notification type is disabled. If no preferences row exists, all types default to enabled. Frontend: settings page gets a "Notification preferences" section with toggle switches for each notification type.

## data quality

- [ ] Add series metadata. Create a `series` PocketBase collection (fields: `name` text required, `open_library_id` text optional, `description` text optional, `created` auto; index on `name`) and a `book_series` PocketBase collection (fields: `book` relation to books, `series` relation to series, `position` number optional — the book's order in the series; unique constraint on `(book, series)`). API endpoints: `GET /books/:workId/series` (returns series the book belongs to with position), `GET /series/:seriesId` (returns series info + ordered book list with covers), `POST /books/:workId/series` (auth required; body: `{series_name, position?}` — finds or creates series by name, links book). When fetching book detail via `GET /books/:workId`, include a `series` array in the response if the book has series memberships. Frontend: on book detail pages, show series badge(s) below the title — e.g. "Book 3 in The Lord of the Rings" — linking to a `/series/:id` page that shows all books in order with covers and a progress indicator for the viewing user. Also add the series info on book covers in shelf grids as a small "#{position}" badge.

- [ ] Populate series data from Open Library during book lookup. When a book is fetched from Open Library (in `books.go` `GetBookDetail`), check the OL work response for a `subject_places`, `subjects`, or — more usefully — the `/works/{workId}/editions.json` entries for `series` fields, or query `/search.json?q=series:{title}` to find related works. A simpler approach: parse the OL work's `links` and `subject_people` for series indicators. If a series is detected, auto-create the `series` and `book_series` records. This is best-effort — not all OL works have series data. Log when series data is found vs. not for visibility into coverage.

## import improvements

- [ ] Add StoryGraph CSV import. StoryGraph exports use a different CSV format than Goodreads. Add `POST /me/import/storygraph/preview` and `POST /me/import/storygraph/commit` endpoints. StoryGraph CSV columns include: `Title`, `Authors`, `ISBN/UID`, `Format`, `Read Status` (to-read/currently-reading/read/did-not-finish), `Star Rating`, `Review`, `Tags`, `Read Dates` (may be a range like "2024/01/15-2024/02/20"). Reuse the same OL lookup chain as Goodreads import. Map StoryGraph statuses to the existing status tag system (to-read → want-to-read, currently-reading → currently-reading, read → finished, did-not-finish → dnf). StoryGraph tags should be imported as label tag keys. Frontend: add a "StoryGraph" tab on the import settings page alongside the existing Goodreads tab, reusing the same preview/configure/commit flow and `ImportForm` component structure.

## Pending PRs

<!-- nephewbot moves tasks here when it opens a PR. Move to docs/planning/completed.md after merging. -->
- [Add delete-all-data endpoint and settings UI](https://github.com/ross-corp/rosslib/pull/37) — DELETE /me/account/data removes all user data; settings page gets Danger Zone with typed confirmation
- [Add create/existing label options to import shelf mapping](https://github.com/ross-corp/rosslib/pull/38) — Goodreads import configure step gains "Create label" and "Add to existing label" actions alongside Tag and Skip
- [Add review likes](https://github.com/ross-corp/rosslib/pull/51) — Toggle like on reviews with heart icon, notifications, and activity recording
- [Add user blocking](https://github.com/ross-corp/rosslib/pull/52) — Block/unblock users with review/search/feed filtering and profile UI
- [Add reading goals](https://github.com/ross-corp/rosslib/pull/53) — Annual reading goal with progress tracking, profile card, and settings form
- [Add @mention notifications in thread comments](https://github.com/ross-corp/rosslib/pull/54) — @username in comments creates thread_mention notifications and renders as profile links
- [Add recommend-to-friend feature](https://github.com/ross-corp/rosslib/pull/55) — Recommend books to users with modal, notifications, and /recommendations page
- [Add detailed reading statistics](https://github.com/ross-corp/rosslib/pull/56) — GET /users/:username/stats with books by year/month, rating distribution, and /[username]/stats page
